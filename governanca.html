<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Governança</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app">
    <aside id="sidebar"></aside>

    <main class="content">
      <div class="page-header">
        <div>
          <h1>Governança</h1>
          <p class="muted">Gestão de feriados e datas relevantes</p>
        </div>
        <a class="btn" href="./index.html">Voltar ao Início</a>
      </div>

      <section class="card">
        <h2>Cadastrar feriado</h2>
        <p class="muted">Adicione manualmente e ele aparecerá no Início.</p>

        <form id="formFeriado" class="form" autocomplete="off">
          <div class="field" style="grid-column: span 3;">
            <label>Data *</label>
            <input type="date" id="data" required />
          </div>

          <div class="field" style="grid-column: span 4;">
            <label>Título (opcional)</label>
            <input type="text" id="titulo" placeholder="Ex.: Carnaval / Feriado municipal" />
          </div>

          <div class="field" style="grid-column: span 5;">
            <label>Observação (opcional)</label>
            <input type="text" id="obs" placeholder="Ex.: Unidade Centro / sem expediente" />
          </div>

          <div class="field" style="grid-column: span 12; display:flex; flex-direction:row; gap:10px; align-items:center;">
            <button class="btn primary" type="submit">Salvar feriado</button>
            <span class="muted" id="msg"></span>
          </div>
        </form>

        <hr class="hr"/>

        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <div>
            <h2>Feriados cadastrados</h2>
            <div class="muted">Você pode excluir qualquer item.</div>
          </div>
          <button class="btn" id="btnRefresh">Atualizar</button>
        </div>

        <div class="list" id="list"></div>
      </section>
    </main>
  </div>

  <script src="./layout.js"></script>
  <script src="./db.js"></script>
  <script>
    window.__PAGE__ = "governanca";
    initLayout();

    const form = document.getElementById("formFeriado");
    const msg = document.getElementById("msg");
    const list = document.getElementById("list");
    const btnRefresh = document.getElementById("btnRefresh");

    function render(){
      const feriados = getFeriados({ prunePast: true, keepToday: true });

      if (!feriados.length) {
        list.innerHTML = `<div class="muted" style="margin-top:10px;">Sem feriados cadastrados.</div>`;
        return;
      }

      list.innerHTML = feriados.map(f => {
        const extra = [f.titulo, f.obs].filter(Boolean).join(" • ");
        return `
          <div class="row">
            <div>
              <div style="font-weight:800;">${fmtDateBR(f.data)} — ${weekdayPT(f.data)}</div>
              <div class="muted">${extra || ""}</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
              <span class="badge">${f.data}</span>
              <button class="btn danger" data-del="${f.id}">Excluir</button>
            </div>
          </div>
        `;
      }).join("");

      // bind delete
      [...document.querySelectorAll("[data-del]")].forEach(btn => {
        btn.addEventListener("click", (e) => {
          const id = e.currentTarget.getAttribute("data-del");
          deleteFeriado(id);
          msg.textContent = "Feriado excluído.";
          render();
        });
      });
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      msg.textContent = "";

      const data = document.getElementById("data").value;
      const titulo = document.getElementById("titulo").value;
      const obs = document.getElementById("obs").value;

      try{
        addFeriado({ data, titulo, obs });
        form.reset();
        msg.textContent = "Feriado salvo.";
        render();
      }catch(err){
        msg.textContent = err?.message || "Erro ao salvar.";
      }
    });

    btnRefresh.addEventListener("click", () => render());
    render();
  </script>
</body>
</html>
