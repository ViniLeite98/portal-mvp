<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro de Terapeuta</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/sidebar/sidebar.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
.content { padding:30px; font-size:14px; }

.section {
  background:#fff;
  border-radius:20px;
  padding:24px;
  margin-bottom:24px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.section h3 {
  margin-bottom:16px;
  border-bottom:1px solid #e5e7eb;
  padding-bottom:6px;
}

.grid { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; }
.grid-2 { grid-template-columns:repeat(2,1fr); }

label { font-weight:600; font-size:13px; }
input, select {
  width:100%;
  padding:6px;
  border-radius:6px;
  border:1px solid #d1d5db;
}

.actions { margin-top:20px; }
button {
  background:#1f2937;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 18px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">
  <aside id="sidebar"></aside>

  <main class="content">
    <h1 id="titulo">Nova Terapeuta</h1>

    <!-- DADOS PESSOAIS -->
    <div class="section">
      <h3>Dados Pessoais</h3>
      <div class="grid">
        <div><label>Nome Completo *</label><input id="nome_completo"></div>
        <div><label>Nome Profissional *</label><input id="nome_profissional"></div>
        <div><label>CPF *</label><input id="cpf"></div>
        <div><label>RG</label><input id="rg"></div>
        <div><label>Data de Nascimento</label><input type="date" id="nascimento"></div>
        <div><label>Email *</label><input id="email"></div>
      </div>
    </div>

    <!-- CONTATOS -->
    <div class="section">
      <h3>Contatos</h3>
      <div class="grid grid-2">
        <div><label>Telefone *</label><input id="telefone"></div>
        <div><label>Contato Emergência</label><input id="telefone_emergencia"></div>
      </div>
    </div>

    <!-- FUNCIONAL -->
    <div class="section">
      <h3>Dados Funcionais</h3>
      <div class="grid">
        <div>
          <label>Tem folga semanal?</label>
          <select id="tem_folga">
            <option>Sim</option>
            <option>Não</option>
          </select>
        </div>
        <div>
          <label>Dia da Folga</label>
          <select id="dia_folga">
            <option></option>
            <option>Segunda</option><option>Terça</option>
            <option>Quarta</option><option>Quinta</option>
            <option>Sexta</option><option>Sábado</option><option>Domingo</option>
          </select>
        </div>
        <div><label>Horário Entrada</label><input type="time" id="hora_entrada"></div>
        <div><label>Horário Saída</label><input type="time" id="hora_saida"></div>
        <div><label>Data de Início *</label><input type="date" id="data_inicio"></div>
        <div>
          <label>Status *</label>
          <select id="status">
            <option>Ativo</option>
            <option>Inativo</option>
          </select>
        </div>
      </div>
    </div>

    <div class="actions">
      <button onclick="salvar()">Salvar</button>
    </div>
  </main>
</div>

<script src="assets/sidebar/sidebar.js"></script>

<script>
/* =========================
   SUPABASE CONFIG
========================= */
const supabase = window.supabase.createClient(
  "https://rymehgsoarjeecuwyhny.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec"
);

const cpfEdit = localStorage.getItem("editarTerapeutaCPF");

/* =========================
   LOAD EDIÇÃO
========================= */
async function carregarEdicao() {
  if (!cpfEdit) return;

  document.getElementById("titulo").innerText = "Editar Terapeuta";

  const { data, error } = await supabase
    .from("terapeutas")
    .select("*")
    .eq("cpf", cpfEdit)
    .single();

  if (error || !data) return;

  cpf.value = data.cpf;
  cpf.disabled = true;

  nome_completo.value = data.nome_completo || "";
  nome_profissional.value = data.nome_profissional || "";
  rg.value = data.rg || "";
  nascimento.value = data.nascimento || "";
  email.value = data.email || "";
  telefone.value = data.telefone || "";
  telefone_emergencia.value = data.telefone_emergencia || "";
  tem_folga.value = data.tem_folga || "Sim";
  dia_folga.value = data.dia_folga || "";
  hora_entrada.value = data.hora_entrada || "";
  hora_saida.value = data.hora_saida || "";
  data_inicio.value = data.data_inicio || "";
  status.value = data.status || "Ativo";
}

carregarEdicao();

/* =========================
   SALVAR (INSERT / UPDATE)
========================= */
async function salvar() {
  if (!cpf.value || !email.value) {
    alert("CPF e Email são obrigatórios");
    return;
  }

  const payload = {
    cpf: cpf.value.replace(/\D/g, ""),
    nome_completo: nome_completo.value,
    nome_profissional: nome_profissional.value,
    rg: rg.value,
    nascimento: nascimento.value,
    email: email.value,
    telefone: telefone.value,
    telefone_emergencia: telefone_emergencia.value,
    tem_folga: tem_folga.value,
    dia_folga: dia_folga.value,
    hora_entrada: hora_entrada.value,
    hora_saida: hora_saida.value,
    data_inicio: data_inicio.value,
    status: status.value
  };

  let result;

  if (cpfEdit) {
    result = await supabase
      .from("terapeutas")
      .update(payload)
      .eq("cpf", cpfEdit);
  } else {
    result = await supabase
      .from("terapeutas")
      .insert(payload);
  }

  if (result.error) {
    alert("Erro ao salvar");
    console.error(result.error);
    return;
  }

  localStorage.removeItem("editarTerapeutaCPF");
  location.href = "equipe.html";
}
</script>

</body>
</html>
