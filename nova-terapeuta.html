<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nova Terapeuta</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/sidebar/sidebar.css">

<style>
.content { padding:30px; }

.section {
  background:#fff;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.grid {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
}

label { font-weight:600; font-size:13px; }
input, select {
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #d1d5db;
}

button {
  background:#1f2937;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">
  <aside id="sidebar"></aside>

  <main class="content">
    <h1 id="titulo">Nova Terapeuta</h1>

    <!-- DADOS -->
    <div class="section">
      <h3>Dados Básicos</h3>
      <div class="grid">
        <div>
          <label>Nome Profissional *</label>
          <input id="nome_profissional">
        </div>

        <div>
          <label>CPF *</label>
          <input id="cpf">
        </div>

        <div>
          <label>Status</label>
          <select id="status">
            <option>Ativo</option>
            <option>Inativo</option>
          </select>
        </div>
      </div>
    </div>

    <button onclick="salvar()">Salvar</button>
  </main>
</div>

<script src="assets/sidebar/sidebar.js"></script>

<!-- SUPABASE SDK -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
/* ======================================================
   SUPABASE — UMA ÚNICA VEZ
====================================================== */
const SUPABASE_URL = "https://rymehgsoarjeecuwyhny.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ======================================================
   MODO EDIÇÃO
====================================================== */
const cpfEdit = localStorage.getItem("editarTerapeutaCPF");

async function carregarEdicao() {
  if (!cpfEdit) return;

  document.getElementById("titulo").innerText = "Editar Terapeuta";
  document.getElementById("cpf").disabled = true;

  const { data, error } = await supabaseClient
    .from("terapeutas")
    .select("*")
    .eq("cpf", cpfEdit)
    .single();

  if (error) {
    alert("Erro ao carregar terapeuta");
    console.error(error);
    return;
  }

  document.getElementById("nome_profissional").value = data.nome_profissional;
  document.getElementById("cpf").value = data.cpf;
  document.getElementById("status").value = data.status || "Ativo";
}

/* ======================================================
   SALVAR (INSERT / UPDATE)
====================================================== */
async function salvar() {
  const nome = document.getElementById("nome_profissional").value.trim();
  const cpf = document.getElementById("cpf").value.trim();
  const status = document.getElementById("status").value;

  if (!nome || !cpf) {
    alert("Preencha nome e CPF");
    return;
  }

  let response;

  if (cpfEdit) {
    response = await supabaseClient
      .from("terapeutas")
      .update({
        nome_profissional: nome,
        status
      })
      .eq("cpf", cpfEdit);
  } else {
    response = await supabaseClient
      .from("terapeutas")
      .insert({
        nome_profissional: nome,
        cpf,
        status
      });
  }

  if (response.error) {
    alert("Erro ao salvar");
    console.error(response.error);
    return;
  }

  localStorage.removeItem("editarTerapeutaCPF");
  location.href = "equipe.html";
}

carregarEdicao();
</script>

</body>
</html>
