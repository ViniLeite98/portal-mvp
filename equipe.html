<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gestão da Equipe</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  justify-content:center;
  align-items:center;
  z-index:20;
}

.modal-content {
  background:#fff;
  width:90%;
  max-width:1100px;
  border-radius:28px;
  padding:24px;
  max-height:90vh;
  overflow-y:auto;
}

.form-grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
}

.form-group {
  display:flex;
  flex-direction:column;
}

.form-group.full { grid-column:span 4; }
.form-group.half { grid-column:span 2; }

.cert-grid {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
}
</style>
</head>

<body>

<nav class="sidebar">
  <h2>Hara Spa</h2>
  <a href="index.html"><i class="fa-solid fa-house"></i> Início</a>
  <a class="active"><i class="fa-solid fa-users"></i> Gestão da Equipe</a>
  <a href="solicitacoes.html"><i class="fa-solid fa-calendar-xmark"></i> Solicitações</a>
  <a href="escalas.html"><i class="fa-solid fa-calendar-days"></i> Escalas</a>
  <a href="materiais.html"><i class="fa-solid fa-box-open"></i> Materiais</a>
  <a href="financeiro.html"><i class="fa-solid fa-coins"></i> Financeiro</a>
</nav>

<div class="content">
  <h1>Gestão da Equipe</h1>

  <div class="card">
    <div class="card-header">
      <div>
        <h3>Lista de Terapeutas</h3>
        <small id="contador"></small>
      </div>
      <button onclick="abrirModal()">+ Nova Terapeuta</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Status</th>
          <th>Horário</th>
          <th>Folga</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2 id="tituloModal">Terapeuta</h2>

    <div class="form-grid">

      <div class="form-group half">
        <label>Nome Completo</label>
        <input id="nomeCompleto">
      </div>

      <div class="form-group half">
        <label>Nome Profissional</label>
        <input id="nomeProfissional">
      </div>

      <div class="form-group">
        <label>Data de Nascimento</label>
        <input type="date" id="dataNascimento">
      </div>

      <div class="form-group">
        <label>CPF</label>
        <input id="cpf">
      </div>

      <div class="form-group">
        <label>Email</label>
        <input id="email">
      </div>

      <div class="form-group">
        <label>Unidade</label>
        <input id="unidade">
      </div>

      <div class="form-group full">
        <label>Endereço</label>
        <input id="endereco">
      </div>

      <div class="form-group">
        <label>Contato</label>
        <input id="contato">
      </div>

      <div class="form-group">
        <label>Contato Emergência</label>
        <input id="contatoEmergencia">
      </div>

      <div class="form-group">
        <label>Tipo de Chave</label>
        <input id="tipoChave">
      </div>

      <div class="form-group">
        <label>Chave Pix</label>
        <input id="chavePix">
      </div>

      <div class="form-group">
        <label>Tem folga semanal?</label>
        <select id="temFolga">
          <option>Sim</option>
          <option>Não</option>
        </select>
      </div>

      <div class="form-group">
        <label>Dia da Folga</label>
        <input id="diaFolga">
      </div>

      <div class="form-group">
        <label>Horário de Entrada</label>
        <input type="time" id="horaEntrada">
      </div>

      <div class="form-group">
        <label>Horário de Saída</label>
        <input type="time" id="horaSaida">
      </div>

      <div class="form-group">
        <label>Data de Início</label>
        <input type="date" id="dataInicio">
      </div>

      <div class="form-group">
        <label>Tipo Sanguíneo</label>
        <input id="tipoSanguineo">
      </div>

      <div class="form-group">
        <label>Status</label>
        <select id="status">
          <option>Ativo</option>
          <option>Inativo</option>
        </select>
      </div>

      <div class="form-group full">
        <label>Certificações</label>
        <div class="cert-grid">
          <label><input type="checkbox" value="Nuru"> Nuru</label>
          <label><input type="checkbox" value="Vivência"> Vivência</label>
          <label><input type="checkbox" value="Podolatria"> Podolatria</label>
          <label><input type="checkbox" value="Casais"> Casais</label>
          <label><input type="checkbox" value="Feminina"> Feminina</label>
        </div>
      </div>

    </div>

    <div style="margin-top:20px;text-align:right">
      <button onclick="fecharModal()">Cancelar</button>
      <button onclick="salvar()">Salvar</button>
    </div>
  </div>
</div>

<script>
let terapeutas = JSON.parse(localStorage.getItem("terapeutas")) || [];
let editId = null;

function render() {
  const tbody = document.getElementById("lista");
  tbody.innerHTML = "";

  terapeutas.forEach(t => {
    tbody.innerHTML += `
      <tr>
        <td>${t.nomeProfissional}</td>
        <td>${t.status}</td>
        <td>${t.horaEntrada || "—"}–${t.horaSaida || "—"}</td>
        <td>${t.temFolga === "Sim" ? t.diaFolga : "—"}</td>
        <td class="actions">
          <i class="fa-solid fa-pen" onclick="editar(${t.id})"></i>
          <i class="fa-solid fa-trash" onclick="excluir(${t.id})"></i>
        </td>
      </tr>`;
  });

  contador.innerText = terapeutas.length + " terapeutas cadastradas";
}

function abrirModal() {
  editId = null;
  document.querySelectorAll("#modal input, #modal select").forEach(e => e.value = "");
  document.querySelectorAll(".cert-grid input").forEach(c => c.checked = false);
  modal.style.display = "flex";
}

function fecharModal() {
  modal.style.display = "none";
}

function salvar() {
  if (horaEntrada.value && horaSaida.value && horaSaida.value <= horaEntrada.value) {
    alert("Horário de saída deve ser maior que o de entrada.");
    return;
  }

  const certificacoes = [...document.querySelectorAll(".cert-grid input:checked")]
    .map(c => c.value);

  const dados = {
    id: editId ?? Date.now(),
    nomeCompleto: nomeCompleto.value,
    nomeProfissional: nomeProfissional.value,
    dataNascimento: dataNascimento.value,
    cpf: cpf.value,
    email: email.value,
    unidade: unidade.value,
    endereco: endereco.value,
    contato: contato.value,
    contatoEmergencia: contatoEmergencia.value,
    tipoChave: tipoChave.value,
    chavePix: chavePix.value,
    temFolga: temFolga.value,
    diaFolga: diaFolga.value,
    horaEntrada: horaEntrada.value,
    horaSaida: horaSaida.value,
    dataInicio: dataInicio.value,
    tipoSanguineo: tipoSanguineo.value,
    status: status.value,
    certificacoes
  };

  if (editId) {
    terapeutas = terapeutas.map(t => t.id === editId ? dados : t);
  } else {
    terapeutas.push(dados);
  }

  localStorage.setItem("terapeutas", JSON.stringify(terapeutas));
  fecharModal();
  render();
}

function editar(id) {
  const t = terapeutas.find(x => x.id === id);
  if (!t) return;

  editId = id;
  Object.keys(t).forEach(k => {
    if (document.getElementById(k)) {
      document.getElementById(k).value = t[k];
    }
  });

  document.querySelectorAll(".cert-grid input")
    .forEach(c => c.checked = (t.certificacoes || []).includes(c.value));

  modal.style.display = "flex";
}

function excluir(id) {
  if (!confirm("Excluir terapeuta?")) return;
  terapeutas = terapeutas.filter(t => t.id !== id);
  localStorage.setItem("terapeutas", JSON.stringify(terapeutas));
  render();
}

render();
</script>

</body>
</html>
