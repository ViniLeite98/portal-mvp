<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gestão da Equipe</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f5f7fb;
}

/* SIDEBAR */
.sidebar {
  width:230px;
  background:#1f2937;
  color:#fff;
  height:100vh;
  position:fixed;
  padding:20px;
}
.sidebar h2 { margin-bottom:30px; }
.sidebar a {
  display:flex;
  align-items:center;
  gap:10px;
  color:#cbd5e1;
  text-decoration:none;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
}
.sidebar a.active,
.sidebar a:hover {
  background:#374151;
  color:#fff;
}

/* CONTEÚDO */
.content {
  margin-left:260px;
  padding:30px;
}

.card {
  background:#fff;
  border-radius:30px;
  padding:24px;
  box-shadow:0 0 10px rgba(0,0,0,.05);
}

.card-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

.card-header h3 {
  margin:0;
  display:flex;
  align-items:center;
  gap:10px;
}

.card-header small {
  color:#6b7280;
}

.btn {
  background:#1f2937;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:10px;
  cursor:pointer;
}

/* TABELA */
table {
  width:100%;
  border-collapse:collapse;
}

thead th {
  text-align:left;
  font-size:13px;
  padding-bottom:10px;
  border-bottom:1px solid #e5e7eb;
}

tbody td {
  padding:14px 0;
  border-bottom:1px solid #f0f0f0;
  font-size:14px;
}

.actions i {
  cursor:pointer;
  margin-right:12px;
}

.actions .fa-trash {
  color:#ef4444;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <h2>Hara Spa</h2>
  <a href="index.html"><i class="fa-solid fa-house"></i> Início</a>
  <a href="equipe.html" class="active"><i class="fa-solid fa-users"></i> Gestão da Equipe</a>
  <a href="solicitacoes.html"><i class="fa-solid fa-calendar-xmark"></i> Solicitações</a>
  <a href="escalas.html"><i class="fa-solid fa-calendar-days"></i> Escalas</a>
  <a href="materiais.html"><i class="fa-solid fa-box-open"></i> Materiais</a>
  <a href="financeiro.html"><i class="fa-solid fa-coins"></i> Financeiro</a>
</nav>

<!-- CONTEÚDO -->
<div class="content">

  <h1>Gestão da Equipe</h1>
  <p class="small">Gerir informações das terapeutas, horários e folgas</p>

  <div class="card">

    <div class="card-header">
      <div>
        <h3><i class="fa-solid fa-user-group"></i> Lista de Terapeutas</h3>
        <small id="contadorAtivas">0 terapeutas ativas</small>
      </div>
      <button class="btn" onclick="novaTerapeuta()">+ Nova terapeuta</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Folga Semanal</th>
          <th>Dias de Folga/Ano</th>
          <th>Data de Início</th>
          <th>Horário</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="listaTerapeutas"></tbody>
    </table>

  </div>

</div>

<script>
/* =========================
   UTILIDADES
========================= */
function formatarData(d) {
  if (!d) return "-";
  const dt = new Date(d);
  return dt.toLocaleDateString("pt-BR", {
    day:"2-digit",
    month:"long",
    year:"numeric"
  });
}

function contarDiasDaSemanaNoAno(diaSemana) {
  const map = {
    "Domingo":0,
    "Segunda":1,
    "Terça":2,
    "Quarta":3,
    "Quinta":4,
    "Sexta":5,
    "Sábado":6
  };
  const alvo = map[diaSemana];
  if (alvo === undefined) return 0;

  const hoje = new Date();
  const inicioAno = new Date(hoje.getFullYear(),0,1);
  let total = 0;

  for (let d = new Date(inicioAno); d <= hoje; d.setDate(d.getDate()+1)) {
    if (d.getDay() === alvo) total++;
  }
  return total;
}

function contarSolicitacoes(nome) {
  const solicitacoes = JSON.parse(localStorage.getItem("solicitacoes")) || [];
  let total = 0;

  solicitacoes
    .filter(s => s.status === "Aprovado" && s.terapeutaNome === nome)
    .forEach(s => {
      const ini = new Date(s.dtInicio);
      const fim = new Date(s.dtFim);
      total += Math.floor((fim - ini)/86400000) + 1;
    });

  return total;
}

/* =========================
   RENDERIZAÇÃO
========================= */
const terapeutas = JSON.parse(localStorage.getItem("terapeutas")) || [];
const tbody = document.getElementById("listaTerapeutas");

const ativas = terapeutas.filter(t => !t.status || t.status === "Ativo");
document.getElementById("contadorAtivas").innerText =
  `${ativas.length} terapeutas ativas`;

tbody.innerHTML = "";

ativas.forEach(t => {

  let folgaSemana = 0;
  if (t.temFolga === "Sim" && t.diaFolga) {
    folgaSemana = contarDiasDaSemanaNoAno(t.diaFolga);
  }

  const folgaSolic = contarSolicitacoes(t.nomeProfissional);
  const totalFolgas = folgaSemana + folgaSolic;

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${t.nomeProfissional}</td>
    <td>${t.temFolga || "Não"}</td>
    <td>${totalFolgas}</td>
    <td>${formatarData(t.dataInicio)}</td>
    <td>${t.horaEntrada || "--"} – ${t.horaSaida || "--"}</td>
    <td class="actions">
      <i class="fa-solid fa-pen" title="Editar"></i>
      <i class="fa-solid fa-trash" title="Excluir" onclick="excluir('${t.nomeProfissional}')"></i>
    </td>
  `;
  tbody.appendChild(tr);
});

/* =========================
   AÇÕES
========================= */
function novaTerapeuta() {
  alert("Abrir formulário de cadastro (próximo passo)");
}

function excluir(nome) {
  if (!confirm(`Excluir ${nome}?`)) return;
  const novos = terapeutas.filter(t => t.nomeProfissional !== nome);
  localStorage.setItem("terapeutas", JSON.stringify(novos));
  location.reload();
}
</script>

</body>
</html>
