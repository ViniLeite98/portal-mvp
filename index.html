<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>In√≠cio</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin:0; font-family:Arial; background:#f5f7fb; }

/* ===== SIDEBAR ===== */
.sidebar {
  width:230px;
  background:#1f2937;
  color:#fff;
  height:100vh;
  position:fixed;
  padding:20px;
}
.sidebar h2 { margin-bottom:30px; }
.sidebar a {
  display:flex;
  align-items:center;
  gap:10px;
  color:#cbd5e1;
  text-decoration:none;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
}
.sidebar a.active,
.sidebar a:hover {
  background:#374151;
  color:#fff;
}

/* ===== CONTE√öDO ===== */
.content {
  margin-left:260px;
  padding:30px;
}

/* ===== CARDS ===== */
.cards {
  display:grid;
  grid-template-columns:1.1fr 1.6fr 1.2fr;
  gap:16px;
}
.card {
  background:#fff;
  border-radius:18px;
  padding:18px;
  box-shadow:0 0 8px rgba(0,0,0,.05);
}
.kpi {
  font-size:34px;
  font-weight:700;
}
.small {
  font-size:12px;
  color:#6b7280;
}

.section-row {
  display:grid;
  grid-template-columns:3.2fr 1.3fr;
  gap:16px;
  margin-top:20px;
}
.section-actions {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
  margin-top:30px;
}

button {
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#1f2937;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- SIDEBAR DIN√ÇMICO -->
<div id="sidebar-container"></div>

<!-- CONTE√öDO -->
<div class="content">
  <h1>In√≠cio</h1>

  <!-- KPIs -->
  <div class="cards">
    <div class="card">
      <h3>Equipe üë•</h3>
      <div id="kpiEquipe" class="kpi">0</div>
      <div class="small">Funcion√°rias ativas</div>
    </div>

    <div class="card">
      <h3>Pr√≥ximas Datas üìÖ</h3>
      <div class="small">‚Äî</div>
    </div>

    <div class="card">
      <h3>Dias Folgados üèÜ</h3>
      <div id="diasFolga" class="small">‚Äî</div>
    </div>
  </div>

  <!-- GR√ÅFICO + CARGA -->
  <div class="section-row">
    <div class="card">
      <h3>For√ßa de Trabalho</h3>
      <canvas id="grafico" height="120"></canvas>
      <div class="small">Distribui√ß√£o por hora</div>
    </div>

    <div class="card">
      <h3>Carga Hor√°ria</h3>
      <div id="rankHoras" class="small">‚Äî</div>
    </div>
  </div>

  <!-- A√á√ïES -->
  <div class="section-actions">
    <div class="card">
      <h3>Gest√£o de Terapeutas</h3>
      <p class="small">Cadastrar e editar terapeutas</p>
      <button onclick="location.href='equipe.html'">Gerir equipe</button>
    </div>

    <div class="card">
      <h3>Solicita√ß√µes</h3>
      <p class="small">Faltas, f√©rias e viagens</p>
      <button onclick="location.href='solicitacoes.html'">Ver solicita√ß√µes</button>
    </div>

    <div class="card">
      <h3>Escalas</h3>
      <p class="small">Distribui√ß√£o por data</p>
      <button onclick="location.href='escalas.html'">Criar escalas</button>
    </div>
  </div>
</div>

<!-- LOAD SIDEBAR -->
<script>
fetch("sidebar.html")
  .then(r => r.text())
  .then(html => {
    document.getElementById("sidebar-container").innerHTML = html;

    // marca item ativo automaticamente
    const page = location.pathname.split("/").pop().replace(".html","");
    document
      .querySelectorAll(".sidebar a")
      .forEach(a => {
        if (a.dataset.page === page) {
          a.classList.add("active");
        }
      });
  });
</script>

<!-- L√ìGICA DO DASHBOARD (INALTERADA) -->
<script>
var terapeutas = JSON.parse(localStorage.getItem("terapeutas") || "[]");
var solicitacoes = JSON.parse(localStorage.getItem("solicitacoes") || "[]");

// KPI equipe
var ativas = terapeutas.filter(t => !t.status || t.status === "Ativo");
document.getElementById("kpiEquipe").innerText = ativas.length;

// Dias folgados
var dias = {};
solicitacoes.forEach(s => {
  if (s.status !== "Aprovado") return;
  if (!s.dataInicio || !s.dataFim) return;

  var ini = new Date(s.dataInicio);
  var fim = new Date(s.dataFim);
  var d = Math.floor((fim - ini) / 86400000) + 1;
  if (d <= 0) return;

  dias[s.terapeutaNome] = (dias[s.terapeutaNome] || 0) + d;
});

document.getElementById("diasFolga").innerHTML =
  Object.keys(dias).length
    ? Object.entries(dias).map(([n,v]) => `<div><b>${n}</b>: ${v} dias</div>`).join("")
    : "‚Äî";

// Gr√°fico for√ßa de trabalho
var horas = [];
for (var h=9; h<=22; h++) horas.push(h);

var contagem = horas.map(hora =>
  ativas.filter(t => {
    if (!t.horaEntrada || !t.horaSaida) return false;
    var he = parseInt(t.horaEntrada.split(":")[0]);
    var hs = parseInt(t.horaSaida.split(":")[0]);
    return hora >= he && hora < hs;
  }).length
);

new Chart(document.getElementById("grafico"), {
  type:"bar",
  data:{
    labels: horas.map(h => h+":00"),
    datasets:[{
      label:"Terapeutas ativas",
      data:contagem,
      backgroundColor:"#3b82f6"
    }]
  },
  options:{ scales:{ y:{ beginAtZero:true, ticks:{ stepSize:1 }}}}
});

// Carga hor√°ria
var carga = {};
ativas.forEach(t => {
  if (!t.horaEntrada || !t.horaSaida) return;
  var he = parseInt(t.horaEntrada.split(":")[0]);
  var hs = parseInt(t.horaSaida.split(":")[0]);
  if (hs > he) carga[t.nomeProfissional] = (carga[t.nomeProfissional]||0) + (hs-he);
});

document.getElementById("rankHoras").innerHTML =
  Object.keys(carga).length
    ? Object.entries(carga).map(([n,v]) => `<div>${n}: ${v}h</div>`).join("")
    : "‚Äî";
</script>

</body>
</html>
