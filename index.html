<script>
/* ===============================
   SUPABASE
================================ */
const SUPABASE_URL = "https://rymehgsoarjeecuwyhny.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ===============================
   CARD 1 — TOTAL ATIVAS
================================ */
async function carregarEquipeAtiva() {

  const { data, error } = await supabaseClient
    .from("terapeutas")
    .select("id", { count: "exact" })
    .eq("status", "Ativo");

  if (error) {
    console.error("Erro equipe ativa:", error);
    return;
  }

  document.getElementById("total-ativas").innerText = data.length;
}

/* ===============================
   CARD HORÁRIOS (FORÇA DE TRABALHO)
================================ */
async function carregarForcaTrabalho() {

  const { data, error } = await supabaseClient
    .from("terapeutas")
    .select("hora_inicio")
    .eq("status", "Ativo");

  if (error) {
    console.error("Erro horários:", error);
    return;
  }

  const contagemPorHora = {};

  data.forEach(t => {
    if (!t.hora_inicio) return;
    const hora = t.hora_inicio.split(":")[0];
    contagemPorHora[hora] = (contagemPorHora[hora] || 0) + 1;
  });

  document.querySelectorAll("[data-hora]").forEach(bar => {
    const hora = bar.dataset.hora;
    const qtd = contagemPorHora[hora] || 0;

    bar.style.height = `${qtd * 20}px`; // escala visual
    bar.title = `${qtd} terapeutas`;
  });
}

/* ===============================
   INIT
================================ */
carregarEquipeAtiva();
carregarForcaTrabalho();
</script>
