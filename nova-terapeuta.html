<script>
function $(id){ return document.getElementById(id); }
function apenasNumeros(v){ return v.replace(/\D/g,""); }

document.addEventListener("DOMContentLoaded", () => {

  let terapeutas = JSON.parse(localStorage.getItem("terapeutas") || "[]");
  const cpfEdicao = localStorage.getItem("editarTerapeutaCPF");

  // =========================
  // MODO EDI√á√ÉO
  // =========================
  if (cpfEdicao) {
    const t = terapeutas.find(t => t.cpf === cpfEdicao);

    if (!t) {
      alert("Erro: terapeuta n√£o encontrada.");
      localStorage.removeItem("editarTerapeutaCPF");
      return;
    }

    $("titulo").innerText = "Editar Terapeuta";
    $("cpf").value = t.cpf;
    $("cpf").disabled = true;

    $("nomeCompleto").value = t.nomeCompleto || "";
    $("nomeProfissional").value = t.nomeProfissional || "";
    $("email").value = t.email || "";
    $("dataNascimento").value = t.dataNascimento || "";
    $("tipoSanguineo").value = t.tipoSanguineo || "";
    $("contato").value = t.contato || "";
    $("contatoEmergencia").value = t.contatoEmergencia || "";
    $("cep").value = t.cep || "";
    $("rua").value = t.rua || "";
    $("numero").value = t.numero || "";
    $("complemento").value = t.complemento || "";
    $("tipoChave").value = t.tipoChave || "";
    $("chavePix").value = t.chavePix || "";
    $("temFolga").value = t.temFolga || "N√£o";
    $("diaFolga").value = t.diaFolga || "";
    $("horaEntrada").value = t.horaEntrada || "";
    $("horaSaida").value = t.horaSaida || "";
    $("dataInicio").value = t.dataInicio || "";
    $("status").value = t.status || "Ativo";
  }

  // =========================
  // SALVAR
  // =========================
  window.salvar = function () {

    const cpfLimpo = apenasNumeros($("cpf").value);
    if (cpfLimpo.length !== 11) {
      alert("CPF inv√°lido");
      return;
    }

    if (!$("email").value.includes("@") || !$("email").value.includes(".")) {
      alert("Email inv√°lido");
      return;
    }

    const terapeuta = {
      cpf: cpfLimpo,
      nomeCompleto: $("nomeCompleto").value,
      nomeProfissional: $("nomeProfissional").value,
      email: $("email").value,
      dataNascimento: $("dataNascimento").value,
      tipoSanguineo: $("tipoSanguineo").value,
      contato: $("contato").value,
      contatoEmergencia: $("contatoEmergencia").value,
      cep: $("cep").value,
      rua: $("rua").value,
      numero: $("numero").value,
      complemento: $("complemento").value,
      tipoChave: $("tipoChave").value,
      chavePix: $("chavePix").value,
      temFolga: $("temFolga").value,
      diaFolga: $("diaFolga").value,
      horaEntrada: $("horaEntrada").value,
      horaSaida: $("horaSaida").value,
      dataInicio: $("dataInicio").value,
      status: $("status").value
    };

    if (cpfEdicao) {
      // üîÅ ATUALIZA
      terapeutas = terapeutas.map(t =>
        t.cpf === cpfEdicao ? terapeuta : t
      );
    } else {
      // ‚ûï NOVO
      if (terapeutas.some(t => t.cpf === cpfLimpo)) {
        alert("CPF j√° cadastrado");
        return;
      }
      terapeutas.push(terapeuta);
    }

    localStorage.setItem("terapeutas", JSON.stringify(terapeutas));
    localStorage.removeItem("editarTerapeutaCPF");
    location.href = "equipe.html";
  };

});
</script>
