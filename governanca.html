<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal MVP • Governança</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header>
    <div class="wrap">
      <div class="top">
        <div class="brand">
          <div class="logo"></div>
          <div>
            <h1>Portal MVP</h1>
            <div class="muted">Governança de dados (MVP)</div>
          </div>
        </div>

        <div class="kpi">
          <span class="pill">Total: <strong id="kpiTotal">0</strong></span>
          <span class="pill">Abertas: <strong id="kpiOpen">0</strong></span>
          <span class="pill">Aprovadas: <strong id="kpiApproved">0</strong></span>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card">
        <div class="hd"><div class="muted">Navegação</div></div>
        <div class="bd">
          <div class="nav" id="nav"></div>
        </div>
        <div class="ft">
          <button class="btn danger small" id="btnReset">Zerar dados</button>
          <span class="note">Somente local</span>
        </div>
      </section>

      <section class="card">
        <div class="hd">
          <h2 style="margin:0;font-size:18px">Governança (cadastros mestres)</h2>
          <div class="muted">Controle de domínios: Unidades e Certificações.</div>
        </div>

        <div class="bd">
          <div class="pill">Cadastros mestres</div>
          <div class="note" style="margin-top:10px">
            Aqui você controla os valores “oficiais” (domínios). Isso evita digitação errada e melhora a governança.
          </div>

          <div class="sep"></div>

          <h3 style="margin:0 0 8px 0;font-size:18px">Unidades</h3>
          <div class="row2">
            <div>
              <label for="unitInput">Adicionar unidade</label>
              <input id="unitInput" placeholder="Ex.: Unidade Centro" />
            </div>
            <div style="display:flex;gap:10px;align-items:flex-end">
              <button class="btn" id="btnAddUnit">Adicionar</button>
              <span class="note" id="unitMsg"></span>
            </div>
          </div>

          <div class="sep"></div>
          <div id="unitList" style="display:flex;flex-direction:column;gap:10px"></div>

          <div class="sep"></div>

          <h3 style="margin:0 0 8px 0;font-size:18px">Certificações</h3>
          <div class="row2">
            <div>
              <label for="certInput">Adicionar certificação</label>
              <input id="certInput" placeholder="Ex.: Drenagem Linfática" />
            </div>
            <div style="display:flex;gap:10px;align-items:flex-end">
              <button class="btn" id="btnAddCert">Adicionar</button>
              <span class="note" id="certMsg"></span>
            </div>
          </div>

          <div class="sep"></div>
          <div id="certList" style="display:flex;flex-direction:column;gap:10px"></div>

          <div class="sep"></div>

          <button class="btn danger" id="btnResetMasters">Restaurar padrões</button>
        </div>
      </section>
    </div>
  </main>

  <script src="./app.js"></script>
  <script>
    const { renderNav, renderKpis, wireResetButton, loadJSON, saveJSON, UNIT_KEY, CERT_KEY } = window.App;

    renderNav("governance");
    renderKpis();
    wireResetButton();

    const DEFAULT_UNITS = ["Unidade 1","Unidade 2","Unidade 3"];
    const DEFAULT_CERTS = ["Massagem Nuru","Massagem Vivência","Podolatria","Massagem Casais","Massagem Feminina"];

    function loadUnits(){
      const v = loadJSON(UNIT_KEY, null);
      return Array.isArray(v) && v.length ? v : DEFAULT_UNITS.slice();
    }
    function loadCerts(){
      const v = loadJSON(CERT_KEY, null);
      return Array.isArray(v) && v.length ? v : DEFAULT_CERTS.slice();
    }

    function renderList(id, items){
      const el = document.getElementById(id);
      el.innerHTML = "";
      for (const name of items){
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.gap = "10px";
        row.style.alignItems = "center";
        row.style.justifyContent = "space-between";
        row.style.padding = "10px";
        row.style.border = "1px solid var(--line)";
        row.style.borderRadius = "12px";
        row.style.background = "rgba(255,255,255,.03)";
        row.innerHTML = `
          <div>${name}</div>
          <button class="btn danger small">Remover</button>
        `;
        row.querySelector("button").addEventListener("click", () => {
          if (!confirm("Remover item?")) return;
          if (id === "unitList") {
            const next = loadUnits().filter(x => x !== name);
            saveJSON(UNIT_KEY, next);
            renderAll();
          } else {
            const next = loadCerts().filter(x => x !== name);
            saveJSON(CERT_KEY, next);
            renderAll();
          }
        });
        el.appendChild(row);
      }
    }

    function addUnit(){
      const input = document.getElementById("unitInput");
      const name = (input.value || "").trim();
      const msg = document.getElementById("unitMsg");
      msg.textContent = "";

      if (!name) { msg.textContent = "Digite uma unidade."; msg.style.color = "var(--bad)"; return; }

      const items = loadUnits();
      if (items.some(x => x.toLowerCase() === name.toLowerCase())){
        msg.textContent = "Já existe."; msg.style.color = "var(--bad)"; return;
      }
      items.push(name);
      saveJSON(UNIT_KEY, items);
      input.value = "";
      msg.textContent = "Unidade adicionada."; msg.style.color = "var(--ok)";
      renderAll();
    }

    function addCert(){
      const input = document.getElementById("certInput");
      const name = (input.value || "").trim();
      const msg = document.getElementById("certMsg");
      msg.textContent = "";

      if (!name) { msg.textContent = "Digite uma certificação."; msg.style.color = "var(--bad)"; return; }

      const items = loadCerts();
      if (items.some(x => x.toLowerCase() === name.toLowerCase())){
        msg.textContent = "Já existe."; msg.style.color = "var(--bad)"; return;
      }
      items.push(name);
      saveJSON(CERT_KEY, items);
      input.value = "";
      msg.textContent = "Certificação adicionada."; msg.style.color = "var(--ok)";
      renderAll();
    }

    function resetMasters(){
      if (!confirm("Restaurar cadastros mestres padrão?")) return;
      saveJSON(UNIT_KEY, DEFAULT_UNITS.slice());
      saveJSON(CERT_KEY, DEFAULT_CERTS.slice());
      renderAll();
    }

    function renderAll(){
      renderList("unitList", loadUnits());
      renderList("certList", loadCerts());
    }

    document.getElementById("btnAddUnit").addEventListener("click", addUnit);
    document.getElementById("btnAddCert").addEventListener("click", addCert);
    document.getElementById("btnResetMasters").addEventListener("click", resetMasters);

    renderAll();
  </script>
</body>
</html>
