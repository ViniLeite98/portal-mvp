<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>In√≠cio</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== LAYOUT ===== */
body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: #f5f7fb;
}

.sidebar {
  width: 230px;
  background: #1f2937;
  color: #fff;
  height: 100vh;
  position: fixed;
  padding: 20px;
}

.sidebar h2 {
  margin-bottom: 30px;
}

.sidebar a {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #cbd5e1;
  text-decoration: none;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 6px;
}

.sidebar a.active,
.sidebar a:hover {
  background: #374151;
  color: #fff;
}

.content {
  margin-left: 260px;
  padding: 30px;
}

/* ===== CARDS ===== */
.cards {
  display: grid;
  grid-template-columns: 1.1fr 1.6fr 1.2fr;
  gap: 16px;
}

.card {
  background: #fff;
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 0 8px rgba(0,0,0,.05);
}

.card h3 {
  font-size: 14px;
  margin: 0;
}

.kpi {
  font-size: 34px;
  font-weight: 700;
  margin-top: 6px;
}

.small {
  font-size: 12px;
  color: #6b7280;
}

/* ===== GR√ÅFICOS ===== */
.section-row {
  display: grid;
  grid-template-columns: 3.2fr 1.3fr;
  gap: 16px;
  margin-top: 20px;
}

/* ===== A√á√ïES ===== */
.section-actions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 30px;
}

.action-card {
  background: #fff;
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 0 8px rgba(0,0,0,.05);
}

.action-card h3 {
  font-size: 15px;
  margin-bottom: 6px;
}

.action-card p {
  font-size: 13px;
  color: #666;
  margin-bottom: 14px;
}

.action-card button {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #1f2937;
  color: #fff;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- MENU -->
<nav class="sidebar">
  <h2>Hara Spa</h2>
  <a href="index.html" class="active"><i class="fa-solid fa-house"></i> In√≠cio</a>
  <a href="equipe.html"><i class="fa-solid fa-users"></i> Gest√£o da Equipe</a>
  <a href="solicitacoes.html"><i class="fa-solid fa-calendar-xmark"></i> Solicita√ß√µes</a>
  <a href="escalas.html"><i class="fa-solid fa-calendar-days"></i> Escalas</a>
</nav>

<div class="content">
  <h1>In√≠cio</h1>

  <!-- KPIs -->
  <div class="cards">

    <div class="card">
      <h3>Equipe üë•</h3>
      <div class="kpi" id="kpiEquipe">0</div>
      <div class="small">Funcion√°rias ativas</div>
    </div>

    <div class="card">
      <h3>Pr√≥ximas Datas üìÖ</h3>
      <div class="small">‚Äî</div>
    </div>

    <div class="card">
      <h3>Dias Folgados üèÜ</h3>
      <div id="diasFolga" class="small" style="margin-top:8px;"></div>
    </div>

  </div>

  <!-- FOR√áA + CARGA -->
  <div class="section-row">

    <div class="card">
      <h3>For√ßa de Trabalho</h3>
      <canvas id="grafico"></canvas>
      <div class="small">Distribui√ß√£o por hora</div>
    </div>

    <div class="card">
      <h3>Carga Hor√°ria</h3>
      <div id="rankHoras" class="small"></div>
    </div>

  </div>

  <!-- A√á√ïES (IGUAL PPT) -->
  <div class="section-actions">

    <div class="action-card">
      <h3>Gest√£o de Terapeutas</h3>
      <p>Cadastrar, editar e gerenciar informa√ß√µes das terapeutas.</p>
      <button onclick="location.href='equipe.html'">Gerir equipe</button>
    </div>

    <div class="action-card">
      <h3>Solicita√ß√µes</h3>
      <p>Registrar faltas, f√©rias, viagens e acompanhar aprova√ß√µes.</p>
      <button onclick="location.href='solicitacoes.html'">Ver solicita√ß√µes</button>
    </div>

    <div class="action-card">
      <h3>Escalas</h3>
      <p>Distribui√ß√£o de terapeutas por data e hor√°rio.</p>
      <button onclick="location.href='escalas.html'">Criar escalas</button>
    </div>

  </div>

</div>

<script>
// ===== STORAGE =====
const terapeutas = JSON.parse(localStorage.getItem("terapeutas")) || [];
const solicitacoes = JSON.parse(localStorage.getItem("solicitacoes")) || [];

// ===== KPI EQUIPE =====
const ativas = terapeutas.filter(t => !t.status || t.status === "Ativo");
document.getElementById("kpiEquipe").innerText = ativas.length;

// ===== DIAS FOLGADOS =====
const diasPorPessoa = {};

solicitacoes
  .filter(s => s.status === "Aprovado")
  .forEach(s => {
    if (!s.dtInicio || !s.dtFim) return;

    const ini = new Date(s.dtInicio);
    const fim = new Date(s.dtFim);
    if (isNaN(ini) || isNaN(fim)) return;

    const dias = Math.floor((fim - ini) / 86400000) + 1;
    if (dias <= 0) return;

    diasPorPessoa[s.terapeutaNome] =
      (diasPorPessoa[s.terapeutaNome] || 0) + dias;
  });

const folgaDiv = document.getElementById("diasFolga");
const ranking = Object.entries(diasPorPessoa)
  .sort((a,b) => b[1] - a[1])
  .slice(0,5);

if (ranking.length === 0) {
  folgaDiv.innerText = "Sem dados ainda.";
} else {
  ranking.forEach(([nome, dias]) => {
    folgaDiv.innerHTML += `<div><b>${nome}</b>: ${dias} dias</div>`;
  });
}

// ===== FOR√áA DE TRABALHO =====
const horas = Array.from({length:14}, (_,i)=>i+9);
const contagem = horas.map(h =>
  ativas.filter(t => {
    if (!t.horaEntrada || !t.horaSaida) return false;
    const he = Number(t.horaEntrada.split(":")[0]);
    const hs = Number(t.horaSaida.split(":")[0]);
    return h >= he && h < hs;
  }).length
);

new Chart(document.getElementById("grafico"), {
  type: "bar",
  data: {
    labels: horas.map(h=>`${h}:00`),
    datasets: [{
      label: "Terapeutas ativas",
      data: contagem,
      backgroundColor: "#3b82f6"
    }]
  },
  options: {
    scales: { y: { beginAtZero:true, ticks:{stepSize:1} } }
  }
});

// ===== CARGA HOR√ÅRIA =====
const rankDiv = document.getElementById("rankHoras");
ativas.forEach(t => {
  if (!t.horaEntrada || !t.horaSaida) return;
  const h = Number(t.horaSaida.split(":")[0]) -
            Number(t.horaEntrada.split(":")[0]);
  rankDiv.innerHTML += `<div>${t.nomeProfissional}: ${h}h</div>`;
});
</script>

</body>
</html>
