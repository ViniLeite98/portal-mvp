<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>In√≠cio</title>

<!-- √çCONES E LIBS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- CSS GLOBAL -->
<link rel="stylesheet" href="assets/css/style.css">

<!-- CSS DO SIDEBAR -->
<link rel="stylesheet" href="assets/sidebar/sidebar.css">

<!-- CSS DO DASHBOARD (ESPEC√çFICO DA P√ÅGINA) -->
<style>
/* ===== CONTE√öDO ===== */
.content {
  padding: 30px;
}

/* ===== CARDS ===== */
.cards {
  display: grid;
  grid-template-columns: 1.1fr 1.6fr 1.2fr;
  gap: 16px;
}

.card {
  background: #fff;
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 0 8px rgba(0,0,0,.05);
}

.kpi {
  font-size: 34px;
  font-weight: 700;
}

.small {
  font-size: 12px;
  color: #6b7280;
}

.section-row {
  display: grid;
  grid-template-columns: 3.2fr 1.3fr;
  gap: 16px;
  margin-top: 20px;
}

.section-actions {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 16px;
  margin-top: 30px;
}

button {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #1f2937;
  color: #fff;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="app">

  <!-- SIDEBAR (CARREGADO VIA JS) -->
  <aside id="sidebar"></aside>

  <!-- CONTE√öDO -->
  <main class="content">
    <h1>In√≠cio</h1>

    <!-- KPIs -->
    <div class="cards">
      <div class="card">
        <h3>Equipe üë•</h3>
        <div id="kpiEquipe" class="kpi">0</div>
        <div class="small">Funcion√°rias ativas</div>
      </div>

      <div class="card">
        <h3>Pr√≥ximas Datas üìÖ</h3>
        <div class="small">‚Äî</div>
      </div>

      <div class="card">
        <h3>Dias Folgados üèÜ</h3>
        <div id="diasFolga" class="small">‚Äî</div>
      </div>
    </div>

    <!-- GR√ÅFICO + CARGA -->
    <div class="section-row">
      <div class="card">
        <h3>For√ßa de Trabalho</h3>
        <canvas id="grafico" height="120"></canvas>
        <div class="small">Distribui√ß√£o por hora</div>
      </div>

      <div class="card">
        <h3>Carga Hor√°ria</h3>
        <div id="rankHoras" class="small">‚Äî</div>
      </div>
    </div>

    <!-- A√á√ïES -->
    <div class="section-actions">
      <div class="card">
        <h3>Gest√£o de Terapeutas</h3>
        <p class="small">Cadastrar e editar terapeutas</p>
        <button onclick="location.href='equipe.html'">Gerir equipe</button>
      </div>

      <div class="card">
        <h3>Solicita√ß√µes</h3>
        <p class="small">Faltas, f√©rias e viagens</p>
        <button onclick="location.href='solicitacoes.html'">Ver solicita√ß√µes</button>
      </div>

      <div class="card">
        <h3>Escalas</h3>
        <p class="small">Distribui√ß√£o por data</p>
        <button onclick="location.href='escalas.html'">Criar escalas</button>
      </div>
    </div>
  </main>

</div>

<!-- JS DO SIDEBAR (CAMINHO CORRETO) -->
<script src="assets/sidebar/sidebar.js"></script>

<!-- ===== L√ìGICA DO DASHBOARD (INALTERADA) ===== -->
<script>
var terapeutas = JSON.parse(localStorage.getItem("terapeutas") || "[]");
var solicitacoes = JSON.parse(localStorage.getItem("solicitacoes") || "[]");

/* KPI EQUIPE */
var ativas = terapeutas.filter(t => !t.status || t.status === "Ativo");
document.getElementById("kpiEquipe").innerText = ativas.length;

/* FUN√á√ÉO DIAS DE FOLGA */
function calcularDiasFolgaAno(t) {
  let total = 0;
  const ano = new Date().getFullYear();
  const inicioAno = new Date(ano,0,1);
  const hoje = new Date();

  if (t.temFolga === "Sim" && t.diaFolga) {
    const inicio = new Date(Math.max(new Date(t.dataInicio || inicioAno), inicioAno));
    for (let d = new Date(inicio); d <= hoje; d.setDate(d.getDate()+1)) {
      const dia = d.toLocaleDateString("pt-BR",{weekday:"long"}).toLowerCase();
      if (dia.includes(t.diaFolga.toLowerCase())) total++;
    }
  }

  solicitacoes.forEach(s => {
    if (s.status !== "Aprovado") return;
    if (s.terapeutaNome !== t.nomeProfissional) return;

    const ini = new Date(s.dataInicio);
    const fim = new Date(s.dataFim);
    if (isNaN(ini) || isNaN(fim)) return;

    const realIni = ini < inicioAno ? inicioAno : ini;
    const realFim = fim > hoje ? hoje : fim;
    if (realFim < realIni) return;

    total += Math.floor((realFim - realIni)/86400000) + 1;
  });

  return total;
}

/* RANKING DIAS */
const rankingDias = ativas
  .map(t => [t.nomeProfissional, calcularDiasFolgaAno(t)])
  .sort((a,b) => b[1] - a[1]);

document.getElementById("diasFolga").innerHTML =
  rankingDias.length
    ? rankingDias.map((r,i)=>`<div>${i+1}¬∫ <b>${r[0]}</b>: ${r[1]} dias</div>`).join("")
    : "‚Äî";

/* GR√ÅFICO */
var horas = [];
for (var h=9; h<=22; h++) horas.push(h);

var contagem = horas.map(hora =>
  ativas.filter(t => {
    if (!t.horaEntrada || !t.horaSaida) return false;
    var he = parseInt(t.horaEntrada.split(":")[0]);
    var hs = parseInt(t.horaSaida.split(":")[0]);
    return hora >= he && hora < hs;
  }).length
);

new Chart(document.getElementById("grafico"), {
  type:"bar",
  data:{
    labels: horas.map(h => h+":00"),
    datasets:[{
      label:"Terapeutas ativas",
      data:contagem,
      backgroundColor:"#3b82f6"
    }]
  },
  options:{ scales:{ y:{ beginAtZero:true, ticks:{ stepSize:1 }}}}
});
</script>

</body>
</html>
