<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Solicitações</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
.page-box {
  background: #fff;
  border-radius: 22px;
  border: 1px solid #e5e7eb;
  padding: 22px;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}

.tabs button {
  background: #f3f4f6;
  border: 1px solid #d1d5db;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
}

.tabs button.active {
  background: #1f2937;
  color: #fff;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.table-card {
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  overflow: hidden;
  margin-top: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  font-size: 14px;
  border-bottom: 1px solid #e5e7eb;
}

th {
  background: #f3f4f6;
  text-align: left;
}

.actions button {
  margin-right: 6px;
}
</style>
</head>

<body>

<!-- MENU -->
<nav class="sidebar">
  <h2>Hara Spa</h2>
  <a href="index.html"><i class="fa-solid fa-house"></i> Início</a>
  <a href="equipe.html"><i class="fa-solid fa-users"></i> Gestão da Equipe</a>
  <a href="solicitacoes.html" class="active"><i class="fa-solid fa-calendar-xmark"></i> Solicitações</a>
  <a href="escalas.html"><i class="fa-solid fa-calendar-days"></i> Escalas</a>
</nav>

<div class="content">
  <div class="page-box">

    <h1>Solicitações</h1>
    <p class="small">Demanda de indisponibilidade</p>

    <!-- TABS -->
    <div class="tabs">
      <button class="active" onclick="showTab('nova')">Nova Solicitação</button>
      <button onclick="showTab('aprovacoes')">Lista de Aprovações</button>
      <button onclick="showTab('gerenciar')">Gerenciar Solicitações</button>
    </div>

    <!-- NOVA SOLICITAÇÃO -->
    <div id="tab-nova">

      <div class="form-row">
        <div>
          <label>Terapeuta *</label>
          <select id="terapeutaSelect"></select>
        </div>

        <div>
          <label>Tipo *</label>
          <select id="tipo">
            <option>Falta</option>
            <option>Férias</option>
            <option>Viagem</option>
            <option>Atestado</option>
            <option>Outro</option>
          </select>
        </div>

        <div>
          <label>Data Início *</label>
          <input type="date" id="dtInicio">
        </div>

        <div>
          <label>Data Fim *</label>
          <input type="date" id="dtFim">
        </div>
      </div>

      <br>
      <label>Justificativa *</label>
      <input id="justificativa">

      <br><br>
      <button onclick="salvarSolicitacao()">Salvar Solicitação</button>
    </div>

    <!-- LISTA DE APROVAÇÕES -->
    <div id="tab-aprovacoes" style="display:none;">
      <h3>Solicitações Pendentes</h3>
      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>Profissional</th>
              <th>Período</th>
              <th>Tipo</th>
              <th>Justificativa</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="listaPendentes"></tbody>
        </table>
      </div>
    </div>

    <!-- GERENCIAR -->
    <div id="tab-gerenciar" style="display:none;">
      <h3>Histórico Completo</h3>
      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>Profissional</th>
              <th>Período</th>
              <th>Tipo</th>
              <th>Status</th>
              <th>Aprovador</th>
            </tr>
          </thead>
          <tbody id="listaTodas"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
// ==========================
// HELPERS
// ==========================
function getTerapeutas() {
  return JSON.parse(localStorage.getItem("terapeutas")) || [];
}

function getSolicitacoes() {
  return JSON.parse(localStorage.getItem("solicitacoes")) || [];
}

function saveSolicitacoes(lista) {
  localStorage.setItem("solicitacoes", JSON.stringify(lista));
}

// ==========================
// TABS
// ==========================
function showTab(tab) {
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  document.querySelectorAll("[id^=tab-]").forEach(t => t.style.display = "none");

  document.querySelector(`.tabs button[onclick="showTab('${tab}')"]`).classList.add("active");
  document.getElementById("tab-" + tab).style.display = "block";
}

// ==========================
// LOAD TERAPEUTAS ATIVAS
// ==========================
const terapeutaSelect = document.getElementById("terapeutaSelect");
const terapeutas = getTerapeutas().filter(t => !t.status || t.status === "Ativo");

terapeutas.forEach(t => {
  const opt = document.createElement("option");
  opt.value = t.id;
  opt.textContent = t.nomeProfissional || t.nomeCompleto;
  terapeutaSelect.appendChild(opt);
});

// ==========================
// NOVA SOLICITAÇÃO
// ==========================
function salvarSolicitacao() {
  const idTerapeuta = terapeutaSelect.value;
  const tipo = document.getElementById("tipo").value;
  const dtInicio = document.getElementById("dtInicio").value;
  const dtFim = document.getElementById("dtFim").value;
  const justificativa = document.getElementById("justificativa").value;

  if (!idTerapeuta || !dtInicio || !dtFim || !justificativa) {
    alert("Preencha todos os campos obrigatórios.");
    return;
  }

  const terapeuta = terapeutas.find(t => t.id == idTerapeuta);

  const nova = {
    id: Date.now(),
    terapeutaId: idTerapeuta,
    terapeutaNome: terapeuta.nomeProfissional || terapeuta.nomeCompleto,
    dtInicio,
    dtFim,
    tipo,
    justificativa,
    status: "Pendente",
    aprovador: ""
  };

  const lista = getSolicitacoes();
  lista.push(nova);
  saveSolicitacoes(lista);

  alert("Solicitação registrada.");
  location.reload();
}

// ==========================
// LISTAS
// ==========================
function render() {
  const pend = document.getElementById("listaPendentes");
  const all = document.getElementById("listaTodas");
  pend.innerHTML = "";
  all.innerHTML = "";

  getSolicitacoes().forEach(s => {
    // Pendentes
    if (s.status === "Pendente") {
      pend.innerHTML += `
        <tr>
          <td>${s.terapeutaNome}</td>
          <td>${s.dtInicio} → ${s.dtFim}</td>
          <td>${s.tipo}</td>
          <td>${s.justificativa}</td>
          <td class="actions">
            <button onclick="aprovar(${s.id})">✅</button>
            <button onclick="rejeitar(${s.id})">❌</button>
          </td>
        </tr>`;
    }

    // Todas
    all.innerHTML += `
      <tr>
        <td>${s.terapeutaNome}</td>
        <td>${s.dtInicio} → ${s.dtFim}</td>
        <td>${s.tipo}</td>
        <td>${s.status}</td>
        <td>${s.aprovador || "-"}</td>
      </tr>`;
  });
}

function aprovar(id) {
  const nome = prompt("Nome do aprovador:");
  if (!nome) return;

  const lista = getSolicitacoes();
  const s = lista.find(x => x.id === id);
  s.status = "Aprovado";
  s.aprovador = nome;
  saveSolicitacoes(lista);
  render();
}

function rejeitar(id) {
  const nome = prompt("Nome do aprovador:");
  if (!nome) return;

  const lista = getSolicitacoes();
  const s = lista.find(x => x.id === id);
  s.status = "Rejeitado";
  s.aprovador = nome;
  saveSolicitacoes(lista);
  render();
}

render();
</script>

</body>
</html>
