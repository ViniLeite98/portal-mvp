<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Teste Certificações</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; padding: 40px; }
select, button { padding: 8px; margin-right: 10px; }
table { margin-top: 20px; border-collapse: collapse; width: 100%; }
th, td { padding: 8px; border-bottom: 1px solid #ccc; }
</style>

</head>
<body>

<h2>Teste Certificações</h2>

<select id="equipe"></select>
<select id="certificacao"></select>
<button onclick="vincular()">Cadastrar</button>

<table>
<thead>
<tr>
<th>Nome</th>
<th>CPF</th>
<th>Certificação</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>

<script>

// ===== SUPABASE DIRETO AQUI (SEM ARQUIVO EXTERNO) =====

const supabase = window.supabase.createClient(
  "https://rymehgsoarjeecuwyhny.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec"
);

// ===== CARREGAR EQUIPE =====
async function carregarEquipe() {
  const { data, error } = await supabase
    .from('equipe')
    .select('id, nome, cpf');

  if (error) {
    console.error(error);
    return;
  }

  const select = document.getElementById("equipe");
  select.innerHTML = "";

  data.forEach(e => {
    select.innerHTML += `<option value="${e.id}">${e.nome} - ${e.cpf}</option>`;
  });
}

// ===== CARREGAR CERTIFICACOES =====
async function carregarCertificacoes() {
  const { data, error } = await supabase
    .from('certificacoes')
    .select('*');

  if (error) {
    console.error(error);
    return;
  }

  const select = document.getElementById("certificacao");
  select.innerHTML = "";

  data.forEach(c => {
    select.innerHTML += `<option value="${c.id}">${c.nome}</option>`;
  });
}

// ===== VINCULAR =====
async function vincular() {
  const equipe_id = document.getElementById("equipe").value;
  const certificacao_id = document.getElementById("certificacao").value;

  const { error } = await supabase
    .from('equipe_certificacoes')
    .insert([{ equipe_id, certificacao_id }]);

  if (error) {
    alert("Erro ou já vinculado");
    console.log(error);
    return;
  }

  carregarLista();
}

// ===== LISTAR =====
async function carregarLista() {
  const { data, error } = await supabase
    .from('equipe_certificacoes')
    .select(`
      id,
      equipe:equipe_id (nome, cpf),
      certificacao:certificacao_id (nome)
    `);

  if (error) {
    console.error(error);
    return;
  }

  const tbody = document.getElementById("lista");
  tbody.innerHTML = "";

  data.forEach(item => {
    tbody.innerHTML += `
      <tr>
        <td>${item.equipe.nome}</td>
        <td>${item.equipe.cpf}</td>
        <td>${item.certificacao.nome}</td>
      </tr>
    `;
  });
}

// ===== INIT =====
carregarEquipe();
carregarCertificacoes();
carregarLista();

</script>

</body>
</html>
