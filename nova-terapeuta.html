<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nova Terapeuta</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/sidebar/sidebar.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
input, select {
  width:100%;
  padding:8px;
  margin-bottom:10px;
}
button {
  background:#1f2937;
  color:#fff;
  padding:10px 16px;
  border:none;
  border-radius:8px;
}
</style>
</head>

<body>

<div class="app">
  <aside id="sidebar"></aside>

  <main class="content">
    <h1 id="titulo">Nova Terapeuta</h1>

    <label>Nome Completo</label>
    <input id="nome_completo">

    <label>CPF</label>
    <input id="cpf">

    <label>Email</label>
    <input id="email">

    <label>Dia da Folga</label>
    <input id="dia_folga">

    <label>Data de In√≠cio</label>
    <input type="date" id="data_inicio">

    <label>Status</label>
    <select id="status">
      <option>Ativo</option>
      <option>Inativo</option>
    </select>

    <button onclick="salvar()">Salvar</button>
  </main>
</div>

<script src="assets/sidebar/sidebar.js"></script>

<script>
const SUPABASE_URL = "https://rymehgsoarjeecuwyhny.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (id) carregarEdicao();

async function carregarEdicao() {
  document.getElementById("titulo").innerText = "Editar Terapeuta";

  const { data, error } = await supabase
    .from("terapeutas")
    .select("*")
    .eq("id", id)
    .single();

  if (error) {
    console.error(error);
    return;
  }

  nome_completo.value = data.nome_completo;
  cpf.value = data.cpf;
  email.value = data.email;
  dia_folga.value = data.dia_folga;
  data_inicio.value = data.data_inicio;
  status.value = data.status;
}

async function salvar() {
  const payload = {
    nome_completo: nome_completo.value,
    cpf: cpf.value,
    email: email.value,
    dia_folga: dia_folga.value,
    data_inicio: data_inicio.value,
    status: status.value
  };

  let result;
  if (id) {
    result = await supabase
      .from("terapeutas")
      .update(payload)
      .eq("id", id);
  } else {
    result = await supabase
      .from("terapeutas")
      .insert(payload);
  }

  if (result.error) {
    alert("Erro ao salvar");
    console.error(result.error);
    return;
  }

  location.href = "equipe.html";
}
</script>

</body>
</html>
