<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/supabase.js"></script>

<script>
const cpfEdit = localStorage.getItem("editarCPF");

if (cpfEdit) {
  carregar();
}

async function carregar() {
  const { data } = await supabase
    .from("terapeutas")
    .select("*")
    .eq("cpf", cpfEdit)
    .single();

  nomeCompleto.value = data.nome_completo;
  nomeProfissional.value = data.nome_profissional;
  cpf.value = data.cpf;
  cpf.disabled = true;
  email.value = data.email;
}

window.salvar = async () => {
  const payload = {
    cpf: cpf.value.replace(/\D/g, ""),
    nome_completo: nomeCompleto.value,
    nome_profissional: nomeProfissional.value,
    email: email.value,
    status: status.value
  };

  const query = cpfEdit
    ? supabase.from("terapeutas").update(payload).eq("cpf", cpfEdit)
    : supabase.from("terapeutas").insert(payload);

  const { error } = await query;

  if (error) {
    alert("Erro ao salvar");
    console.error(error);
    return;
  }

  localStorage.removeItem("editarCPF");
  location.href = "equipe.html";
};
</script>
