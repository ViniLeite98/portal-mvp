<script>
/* =========================
   UTILIDADES
========================= */
function apenasNumeros(v){
  return v.replace(/\D/g,"");
}

/* =========================
   CARREGAR TERAPEUTAS
========================= */
let terapeutas = JSON.parse(localStorage.getItem("terapeutas") || "[]");
const cpfEdicao = localStorage.getItem("editarTerapeutaCPF");

/* =========================
   SE FOR EDI√á√ÉO ‚Üí PREENCHE
========================= */
if (cpfEdicao) {
  const t = terapeutas.find(t => t.cpf === cpfEdicao);

  if (!t) {
    alert("Terapeuta n√£o encontrada.");
    localStorage.removeItem("editarTerapeutaCPF");
  } else {
    // üîπ Dados pessoais
    nomeCompleto.value       = t.nomeCompleto || "";
    nomeProfissional.value   = t.nomeProfissional || "";
    cpf.value                = t.cpf || "";
    cpf.disabled             = true; // üîí CPF N√ÉO EDITA
    email.value              = t.email || "";
    dataNascimento.value     = t.dataNascimento || "";
    tipoSanguineo.value      = t.tipoSanguineo || "";

    // üîπ Contato
    contato.value            = t.contato || "";
    contatoEmergencia.value  = t.contatoEmergencia || "";

    // üîπ Endere√ßo
    cep.value                = t.cep || "";
    rua.value                = t.rua || "";
    numero.value             = t.numero || "";
    complemento.value        = t.complemento || "";

    // üîπ Pagamento
    tipoChave.value          = t.tipoChave || "";
    chavePix.value           = t.chavePix || "";

    // üîπ Funcional
    temFolga.value           = t.temFolga || "N√£o";
    diaFolga.value           = t.diaFolga || "";
    horaEntrada.value        = t.horaEntrada || "";
    horaSaida.value          = t.horaSaida || "";
    dataInicio.value         = t.dataInicio || "";
    status.value             = t.status || "Ativo";
  }
}

/* =========================
   SALVAR
========================= */
function salvar(){
  const cpfLimpo = apenasNumeros(cpf.value);

  if (cpfLimpo.length !== 11) {
    alert("CPF inv√°lido");
    return;
  }

  if (!email.value.includes("@") || !email.value.includes(".")) {
    alert("Email inv√°lido");
    return;
  }

  const terapeuta = {
    cpf: cpfLimpo,
    nomeCompleto: nomeCompleto.value,
    nomeProfissional: nomeProfissional.value,
    email: email.value,
    dataNascimento: dataNascimento.value,
    tipoSanguineo: tipoSanguineo.value,
    contato: contato.value,
    contatoEmergencia: contatoEmergencia.value,
    cep: cep.value,
    rua: rua.value,
    numero: numero.value,
    complemento: complemento.value,
    tipoChave: tipoChave.value,
    chavePix: chavePix.value,
    temFolga: temFolga.value,
    diaFolga: diaFolga.value,
    horaEntrada: horaEntrada.value,
    horaSaida: horaSaida.value,
    dataInicio: dataInicio.value,
    status: status.value
  };

  if (cpfEdicao) {
    // üîÅ ATUALIZA
    terapeutas = terapeutas.map(t =>
      t.cpf === cpfEdicao ? terapeuta : t
    );
  } else {
    // ‚ûï NOVO (evita duplicado)
    if (terapeutas.some(t => t.cpf === cpfLimpo)) {
      alert("CPF j√° cadastrado");
      return;
    }
    terapeutas.push(terapeuta);
  }

  localStorage.setItem("terapeutas", JSON.stringify(terapeutas));
  localStorage.removeItem("editarTerapeutaCPF");
  location.href = "equipe.html";
}
</script>
