<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nova Terapeuta</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/sidebar/sidebar.css">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
.content { padding:30px; }
.section {
  background:#fff;
  padding:24px;
  border-radius:16px;
  margin-bottom:24px;
}
.grid {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
}
.grid-2 { grid-template-columns:repeat(2,1fr); }
label { font-weight:600; font-size:13px; }
input, select {
  width:100%; padding:8px;
  border:1px solid #d1d5db;
  border-radius:6px;
}
button {
  background:#1f2937;
  color:#fff;
  padding:10px 18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">
  <aside id="sidebar"></aside>

  <main class="content">
    <h1 id="titulo">Nova Terapeuta</h1>

    <!-- DADOS PESSOAIS -->
    <div class="section">
      <h3>Dados Pessoais</h3>
      <div class="grid">
        <div><label>Nome Completo *</label><input id="nome_completo"></div>
        <div><label>Nome Profissional *</label><input id="nome_profissional"></div>
        <div><label>CPF *</label><input id="cpf"></div>

        <div><label>RG</label><input id="rg"></div>
        <div><label>Data Nascimento</label><input type="date" id="nascimento"></div>
        <div><label>Email *</label><input id="email"></div>

        <div>
          <label>Tipo Sanguíneo</label>
          <select id="tipo_sanguineo">
            <option></option>
            <option>A+</option><option>A-</option>
            <option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option>
            <option>O+</option><option>O-</option>
          </select>
        </div>
      </div>
    </div>

    <!-- CONTATOS -->
    <div class="section">
      <h3>Contatos</h3>
      <div class="grid-2 grid">
        <div><label>Telefone *</label><input id="telefone"></div>
        <div><label>Contato Emergência</label><input id="telefone_emergencia"></div>
      </div>
    </div>

    <!-- ENDEREÇO -->
    <div class="section">
      <h3>Endereço</h3>
      <div class="grid">
        <div><label>CEP</label><input id="cep"></div>
        <div><label>Rua</label><input id="rua"></div>
        <div><label>Número</label><input id="numero"></div>
        <div><label>Complemento</label><input id="complemento"></div>
        <div><label>Bairro</label><input id="bairro"></div>
        <div><label>Cidade</label><input id="cidade"></div>
        <div><label>UF</label><input id="uf"></div>
      </div>
    </div>

    <!-- PAGAMENTO -->
    <div class="section">
      <h3>Pagamento</h3>
      <div class="grid-2 grid">
        <div>
          <label>Tipo PIX</label>
          <select id="pix_tipo">
            <option></option>
            <option>CPF</option>
            <option>Email</option>
            <option>Telefone</option>
            <option>Aleatória</option>
          </select>
        </div>
        <div><label>Chave PIX</label><input id="pix_chave"></div>
      </div>
    </div>

    <!-- FUNCIONAL -->
    <div class="section">
      <h3>Dados Funcionais</h3>
      <div class="grid">
        <div><label>Tem folga?</label><select id="tem_folga"><option>Sim</option><option>Não</option></select></div>
        <div><label>Dia Folga</label><input id="dia_folga"></div>
        <div><label>Hora Entrada</label><input type="time" id="hora_entrada"></div>
        <div><label>Hora Saída</label><input type="time" id="hora_saida"></div>
        <div><label>Data Início</label><input type="date" id="data_inicio"></div>
        <div><label>Status</label><select id="status"><option>Ativo</option><option>Inativo</option></select></div>
      </div>
    </div>

    <button onclick="salvar()">Salvar</button>
  </main>
</div>

<script src="assets/sidebar/sidebar.js"></script>

<script>
const supabase = supabaseJs.createClient(
  "https://rymehgsoarjeecuwyhny.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5bWVoZ3NvYXJqZWVjdXd5aG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTc0ODUsImV4cCI6MjA4NjIzMzQ4NX0.K9BUapByrh6TsSi5jEkL8HGLDmMT_tGSSykl7LGxIec"
);

const params = new URLSearchParams(window.location.search);
const cpfEdit = params.get("cpf");

if (cpfEdit) carregarEdicao(cpfEdit);

async function carregarEdicao(cpf) {
  document.getElementById("titulo").innerText = "Editar Terapeuta";
  const { data } = await supabase.from("terapeutas").select("*").eq("cpf", cpf).single();

  for (const k in data) {
    if (document.getElementById(k)) {
      document.getElementById(k).value = data[k] ?? "";
    }
  }

  document.getElementById("cpf").disabled = true;
}

async function salvar() {
  const payload = {};
  document.querySelectorAll("input, select").forEach(i => payload[i.id] = i.value);

  const { error } = await supabase
    .from("terapeutas")
    .upsert(payload, { onConflict: "cpf" });

  if (error) {
    alert("Erro ao salvar");
    console.error(error);
  } else {
    alert("Salvo com sucesso");
    window.location.href = "equipe.html";
  }
}
</script>

</body>
</html>
