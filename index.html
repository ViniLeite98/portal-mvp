<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>In√≠cio</title>

  <!-- CSS GLOBAL -->
  <link rel="stylesheet" href="assets/css/style.css">

  <!-- ICONES -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- CHART -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- SIDEBAR PADR√ÉO -->
<nav class="sidebar">
  <h2>Hara Spa</h2>

  <a href="index.html"><i class="fa-solid fa-house"></i> In√≠cio</a>
  <a href="equipe.html"><i class="fa-solid fa-users"></i> Gest√£o da Equipe</a>
  <a href="solicitacoes.html"><i class="fa-solid fa-calendar-xmark"></i> Solicita√ß√µes</a>
  <a href="escalas.html"><i class="fa-solid fa-calendar-days"></i> Escalas</a>
  <a href="disponibilidade.html"><i class="fa-solid fa-table-cells"></i> Disponibilidade</a>
  <a href="materiais.html"><i class="fa-solid fa-box-open"></i> Materiais</a>
  <a href="financeiro.html"><i class="fa-solid fa-coins"></i> Financeiro</a>
</nav>

<!-- CONTE√öDO -->
<div class="content">
  <h1>In√≠cio</h1>
  <p class="small">Vis√£o geral da opera√ß√£o</p>

  <!-- KPIs -->
  <div class="cards">
    <div class="card">
      <h3>Equipe üë•</h3>
      <div id="kpiEquipe" class="kpi">0</div>
      <div class="small">Funcion√°rias ativas</div>
    </div>

    <div class="card">
      <h3>Pr√≥ximas Datas üìÖ</h3>
      <div class="small">‚Äî</div>
    </div>

    <div class="card">
      <h3>Dias Folgados üèÜ</h3>
      <div id="diasFolga" class="small">‚Äî</div>
    </div>
  </div>

  <!-- GR√ÅFICOS -->
  <div class="section-row">
    <div class="card">
      <h3>For√ßa de Trabalho</h3>
      <canvas id="grafico"></canvas>
      <div class="small">Distribui√ß√£o por hora</div>
    </div>

    <div class="card">
      <h3>Carga Hor√°ria</h3>
      <div id="rankHoras" class="small">‚Äî</div>
    </div>
  </div>

  <!-- A√á√ïES -->
  <div class="section-actions">
    <div class="card">
      <h3>Gest√£o de Terapeutas</h3>
      <p class="small">Cadastrar e editar terapeutas</p>
      <button onclick="location.href='equipe.html'">Gerir equipe</button>
    </div>

    <div class="card">
      <h3>Solicita√ß√µes</h3>
      <p class="small">Faltas, f√©rias e viagens</p>
      <button onclick="location.href='solicitacoes.html'">Ver solicita√ß√µes</button>
    </div>

    <div class="card">
      <h3>Escalas</h3>
      <p class="small">Distribui√ß√£o por data</p>
      <button onclick="location.href='escalas.html'">Criar escalas</button>
    </div>
  </div>
</div>

<!-- JS GLOBAL (MENU ATIVO) -->
<script src="assets/js/app.js"></script>

<!-- ===============================
     SCRIPT ORIGINAL (INALTERADO)
     =============================== -->
<script>
// LOAD STORAGE
var terapeutas = JSON.parse(localStorage.getItem("terapeutas") || "[]");
var solicitacoes = JSON.parse(localStorage.getItem("solicitacoes") || "[]");

// KPI EQUIPE
var ativas = terapeutas.filter(function(t){
  return !t.status || t.status === "Ativo";
});
document.getElementById("kpiEquipe").innerText = ativas.length;

// DIAS FOLGADOS
var dias = {};
solicitacoes.forEach(function(s){
  if (s.status !== "Aprovado") return;
  if (!s.dataInicio || !s.dataFim) return;

  var ini = new Date(s.dataInicio);
  var fim = new Date(s.dataFim);
  if (isNaN(ini) || isNaN(fim)) return;

  var d = Math.floor((fim - ini) / 86400000) + 1;
  if (d <= 0) return;

  var nome = s.terapeutaNome || "‚Äî";
  dias[nome] = (dias[nome] || 0) + d;
});

var folgaHTML = "";
for (var n in dias) {
  folgaHTML += "<div><b>" + n + "</b>: " + dias[n] + " dias</div>";
}
document.getElementById("diasFolga").innerHTML = folgaHTML || "‚Äî";

// FOR√áA DE TRABALHO
var horas = [];
for (var h = 9; h <= 22; h++) horas.push(h);

var contagem = horas.map(function(hora){
  return ativas.filter(function(t){
    if (!t.horaEntrada || !t.horaSaida) return false;
    var he = parseInt(t.horaEntrada.split(":")[0],10);
    var hs = parseInt(t.horaSaida.split(":")[0],10);
    return !isNaN(he) && !isNaN(hs) && hora >= he && hora < hs;
  }).length;
});

var ctx = document.getElementById("grafico");
if (ctx) {
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: horas.map(function(h){ return h + ":00"; }),
      datasets: [{
        label: "Terapeutas ativas",
        data: contagem,
        backgroundColor: "#3b82f6"
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
    }
  });
}

// CARGA HOR√ÅRIA
var carga = {};
ativas.forEach(function(t){
  if (!t.horaEntrada || !t.horaSaida) return;

  var he = parseInt(t.horaEntrada.split(":")[0],10);
  var hs = parseInt(t.horaSaida.split(":")[0],10);
  if (isNaN(he) || isNaN(hs) || hs <= he) return;

  var nome = t.nomeProfissional || t.nomeCompleto || "‚Äî";
  carga[nome] = (carga[nome] || 0) + (hs - he);
});

var rankHTML = "";
for (var nome in carga) {
  rankHTML += "<div>" + nome + ": " + carga[nome] + "h</div>";
}
document.getElementById("rankHoras").innerHTML = rankHTML || "‚Äî";
</script>

</body>
</html>
